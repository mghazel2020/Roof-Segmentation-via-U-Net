# Machine Learning Excercise
* Candidate: Mohsen Ghazel
* Date: May 17, 2023

# 1. Objective

The objective of this repository is to document my implementation of U-Net image segmentation model to detect roofs of buildings and othe rstructures from areial color imagery.

# 2. Submitted Code
## 2.1 Folder Structure
The  submitted```CV_Exercise_MGhazel_Solutions``` directory contains the following sub-folders structure:
* The ```code``` sub-folder contains the required files for training and deploying the CNN model:
  - ```utils.py```: Contains shared Python imports, global variables and utlity functions
  - ```train.py```: Script for training the model
  - ```inference.py```: Script for deploying the model

* The ```data``` sub-folder contains the input image and its associated labels image:
  - ```image.tif```
  - ```labels.tif```
* The ```output``` sub-folder contains the generated output, which sub-divided into the following 3 sub-folders: 
  - ```training```:  The output generated by the training script, such as illustrated in the previous sections
  - ```trained_model```: The trained model in ```h5``` format (ex. ```roof_top_detection_trained_model_num_epochs_100.h5```)
  - ```inference```: Output generated by the inference script, consisting of the model predictions of the labels of the full input image.
* The ```google_colab``` sub-folder: 
  - ```CV_Exercise.ipynb```:  Contains a Google Colaborary Notebook:
    - I initially developed my solutions using a Google Colab Notebnook
    - This allowed me to explore various solutions and experiemnt with different hyper-paramaters and models using of the Google Colab GPU, as I do not have GPU on my personal laptop.
  - The ```data``` sub-folder contains the input image and its associated labels image should be located on your Google Drive
    - ```image.tif```
    - ```labels.tif```
  - The ```output``` sub-folder contains the generated output, should be located on your Google Drive
* The ```github``` sub-folder contains a screenshot of this GitHub repository access information
* The ```requirements.txt``` file
* The ```README.md``` file
 
## 2.2 Requirements

The content of the ```requirements.txt``` file is as follows: 

```
numpy~=1.23.5
matplotlib~=3.7.1
opencv-python~=4.7.0.72
tensorflow~=2.12.0
pandas~=1.5.3
sklearn~=0.0.post1
scikit-learn~=1.2.2
```

## 2.3 Executing the Code (```train.py``` and ```inference.py```)

Suppose my submitted solutions folder (```CV_Exercise_MGhazel_Solutions```) is copied to your ```C-Drive```:
1. Navigate to: ```C:\CV_Exercise_MGhazel_Solutions```
```(base) C:\CV_Exercise_MGhazel_Solutions>```

2. List the contents of:  ```C:\CV_Exercise_MGhazel_Solutions```
```
(base) C:\CV_Exercise_MGhazel_Solutions>dir
 Volume in drive C is OS
 Volume Serial Number is 34B1-996A
 Directory of C:\CV_Exercise_MGhazel_Solutions
2023-03-25  01:02 PM    <DIR>          .
2023-03-25  01:03 PM    <DIR>          code
2023-03-25  01:03 PM    <DIR>          data
2023-03-25  01:04 PM    <DIR>          google_colab
2023-03-25  12:53 PM    <DIR>          output
               0 File(s)              0 bytes
               5 Dir(s)  916,878,131,200 bytes free
(base) C:\CV_Exercise_MGhazel_Solutions>
```

3. Change to the ```code``` sub-directory:
```
(base) C:\CV_Exercise_MGhazel_Solutions>cd code
(base) C:\CV_Exercise_MGhazel_Solutions\code>
```

 4. To run the ```train.py``` file, change to the directory: ```C:\CV_Exercise_MGhazel_Solutions\code``` and excute the following command:
    
```
    (base) C:\CV_Exercise_MGhazel_Solutions\code>python train.py
```

* To examine the output of the model ```training```, see the contents of the following output subfolders:
  -  ```C:\CV_Exercise_MGhazel_Solutions\output\training```:
  -  ```C:\CV_Exercise_MGhazel_Solutions\output\trained_model```:
    
 5. To run the ```inference.py``` file, change to the following directory: ```C:\CV_Exercise_MGhazel_Solutions\code``` and excute the following command
```
(base) C:\CV_Exercise_MGhazel_Solutions\code>python inference.py
```
* To examine the output of the model ```inference```, see the contents of the following output subfolder: ```C:\CV_Exercise_MGhazel_Solutions\output\inference```

## 2.4 Executing the Google Colab Notebook: ```CV_Exercise.ipynb```

To execute the Google Colaboratory Notebook, please follow the following steps:
1. Create a folder (ex. ```temp```) on your Google Drive (```My Drive```) 
2. Create a ```code``` sub-folder and copy the ```CV_Exercise.ipynb``` to ```My Drive\temp\code```
3. Create a sub-folder ```data``` and copy the input data ```image.tif``` and ```labels.tif``` to ```My Drive\temp\data```
4. Create a sub-folder ```output``` so the output will be saved to ```My Drive\temp\output```
5. Open ``CV_Exercise.ipynb``` using Google Colaborator
6. Edit the ```DATA_PATH``` and ```OUTPUT_PATH``` to point to your ```data``` and ```output``` sub-folders described above
    ```
    #-------------------------------------------------------------------------------
    #%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% EDIT DATA_PATH %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    #-------------------------------------------------------------------------------
    # Set the data path: Relative to my Google Drive
    #-------------------------------------------------------------------------------
    # - contains the image.tiff and its binary mask: labels.tif
    DATA_PATH = "/content/drive/MyDrive/Colab_Notebooks/Project/data/"
    
    #-------------------------------------------------------------------------------
    #%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% EDIT OUTPUT_PATH %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    #-------------------------------------------------------------------------------
    # Set the output path: Relative to my Google Drive
    #-------------------------------------------------------------------------------
    # The output will be saved here
    OUTPUT_PATH = '/content/drive/MyDrive/Colab_Notebooks/Project/output/'
    ```
7. Explore the Notebook and experiment with:
    * Using different hyper-parameters.

